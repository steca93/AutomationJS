"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.mobileDetector = mobileDetector;
exports.getBrowserObject = getBrowserObject;
exports.transformToCharString = transformToCharString;
exports.parseCSS = parseCSS;
exports.checkUnicode = checkUnicode;
exports.findElement = findElement;
exports.findElements = findElements;
exports.getElementFromResponse = exports.getPrototype = exports.findStrategy = void 0;

require("source-map-support/register");

var _fs = _interopRequireDefault(require("fs"));

var _path = _interopRequireDefault(require("path"));

var _cssValue = _interopRequireDefault(require("css-value"));

var _rgb2hex = _interopRequireDefault(require("rgb2hex"));

var _graphemeSplitter = _interopRequireDefault(require("grapheme-splitter"));

var _constants = require("./constants");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const DEFAULT_SELECTOR = 'css selector';
const DIRECT_SELECTOR_REGEXP = /^(id|css selector|xpath|link text|partial link text|name|tag name|class name|-android uiautomator|-ios uiautomation|accessibility id):(.+)/;
const INVALID_SELECTOR_ERROR = new Error('selector needs to be typeof `string` or `function`');

const findStrategy = function (value, isW3C) {
  /**
   * set default selector
   */
  let using = DEFAULT_SELECTOR;
  /**
   * check if user has specified locator strategy directly
   */

  const match = value.match(DIRECT_SELECTOR_REGEXP);

  if (match) {
    /**
     * ensure selector strategy is supported
     */
    if (isW3C && !_constants.W3C_SELECTOR_STRATEGIES.includes(match[1])) {
      throw new Error('InvalidSelectorStrategy'); // ToDo: move error to wdio-error package
    }

    return {
      using: match[1],
      value: match[2]
    };
  } // use xPath strategy if value starts with //


  if (value.indexOf('/') === 0 || value.indexOf('(') === 0 || value.indexOf('../') === 0 || value.indexOf('./') === 0 || value.indexOf('*/') === 0) {
    using = 'xpath'; // use link text strategy if value starts with =
  } else if (value.indexOf('=') === 0) {
    using = 'link text';
    value = value.slice(1); // use partial link text strategy if value starts with *=
  } else if (value.indexOf('*=') === 0) {
    using = 'partial link text';
    value = value.slice(2); // recursive element search using the UiAutomator library (Android only)
  } else if (value.indexOf('android=') === 0) {
    using = '-android uiautomator';
    value = value.slice(8); // recursive element search using the UIAutomation library (iOS-only)
  } else if (value.indexOf('ios=') === 0) {
    using = '-ios uiautomation';
    value = value.slice(4); // recursive element search using accessibility id
  } else if (value.indexOf('~') === 0) {
    using = 'accessibility id';
    value = value.slice(1); // class name mobile selector
    // for iOS = UIA...
    // for Android = android.widget
  } else if (value.slice(0, 3) === 'UIA' || value.slice(0, 15) === 'XCUIElementType' || value.slice(0, 14).toLowerCase() === 'android.widget') {
    using = 'class name'; // use tag name strategy if value contains a tag
    // e.g. "<div>" or "<div />"
  } else if (value.search(/<[a-zA-Z-]+( \/)*>/g) >= 0) {
    using = 'tag name';
    value = value.replace(/<|>|\/|\s/g, ''); // use name strategy if value queries elements with name attributes
    // e.g. "[name='myName']" or '[name="myName"]'
  } else if (value.search(/^\[name=("|')([a-zA-z0-9\-_. ]+)("|')]$/) >= 0) {
    using = 'name';
    value = value.match(/^\[name=("|')([a-zA-z0-9\-_. ]+)("|')]$/)[2]; // allow to move up to the parent or select current element
  } else if (value === '..' || value === '.') {
    using = 'xpath'; // any element with given class, id, or attribute and content
    // e.g. h1.header=Welcome or [data-name=table-row]=Item or #content*=Intro
  } else {
    const match = value.match(new RegExp([// HTML tag
    /^([a-z0-9]*)/, // optional . or # + class or id
    /(?:(\.|#)(-?[_a-zA-Z]+[_a-zA-Z0-9-]*))?/, // optional [attribute-name="attribute-value"]
    /(?:\[(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)(?:=(?:"|')([a-zA-z0-9\-_. ]+)(?:"|'))?\])?/, // *=query or =query
    /(\*)?=(.+)$/].map(rx => rx.source).join('')));

    if (match) {
      const PREFIX_NAME = {
        '.': 'class',
        '#': 'id'
      };
      const conditions = [];
      const [tag, prefix, name, attrName, attrValue, partial, query] = match.slice(1);

      if (prefix) {
        conditions.push(`contains(@${PREFIX_NAME[prefix]}, "${name}")`);
      }

      if (attrName) {
        conditions.push(attrValue ? `contains(@${attrName}, "${attrValue}")` : `@${attrName}`);
      }

      if (partial) {
        conditions.push(`contains(., "${query}")`);
      } else {
        conditions.push(`normalize-space() = "${query}"`);
      }

      using = 'xpath';
      value = `.//${tag || '*'}[${conditions.join(' and ')}]`;
    }
  }
  /**
   * ensure selector strategy is supported
   */


  if (isW3C && !_constants.W3C_SELECTOR_STRATEGIES.includes(using)) {
    throw new Error('InvalidSelectorStrategy'); // ToDo: move error to wdio-error package
  }

  return {
    using,
    value
  };
};

exports.findStrategy = findStrategy;

const applyScopePrototype = (prototype, scope) => {
  const dir = _path.default.resolve(__dirname, 'commands', scope);

  const files = _fs.default.readdirSync(dir);

  for (let filename of files) {
    const commandName = _path.default.basename(filename, _path.default.extname(filename));

    prototype[commandName] = {
      value: require(_path.default.join(dir, commandName)).default
    };
  }
};
/**
 * enhances objects with element commands
 */


const getPrototype = scope => {
  const prototype = {};
  /**
   * register action commands
   */

  applyScopePrototype(prototype, scope);
  return prototype;
};
/**
 * get element id from WebDriver response
 * @param  {object} res         body object from response
 * @return {string|undefined}   element id or null if element couldn't be found
 */


exports.getPrototype = getPrototype;

const getElementFromResponse = res => {
  /**
   * deprecated JSONWireProtocol response
   */
  if (res.ELEMENT) {
    return res.ELEMENT;
  }
  /**
   * W3C WebDriver response
   */


  if (res[_constants.ELEMENT_KEY]) {
    return res[_constants.ELEMENT_KEY];
  }

  return null;
};
/**
 * check if current platform is mobile device
 *
 * @param  {Object}  caps  capabilities
 * @return {Boolean}       true if platform is mobile device
 */


exports.getElementFromResponse = getElementFromResponse;

function mobileDetector(caps) {
  let isMobile = Boolean(typeof caps['appium-version'] !== 'undefined' || typeof caps['device-type'] !== 'undefined' || typeof caps['deviceType'] !== 'undefined' || typeof caps['device-orientation'] !== 'undefined' || typeof caps['deviceOrientation'] !== 'undefined' || typeof caps.deviceName !== 'undefined' || // Check browserName for specific values
  caps.browserName === '' || caps.browserName !== undefined && (caps.browserName.toLowerCase() === 'ipad' || caps.browserName.toLowerCase() === 'iphone' || caps.browserName.toLowerCase() === 'android'));
  let isIOS = Boolean(caps.platformName && caps.platformName.match(/iOS/i) || caps.deviceName && caps.deviceName.match(/(iPad|iPhone)/i));
  let isAndroid = Boolean(caps.platformName && caps.platformName.match(/Android/i) || caps.browserName && caps.browserName.match(/Android/i));
  return {
    isMobile,
    isIOS,
    isAndroid
  };
}
/**
 * traverse up the scope chain until browser element was reached
 */


function getBrowserObject(elem) {
  return elem.parent ? getBrowserObject(elem.parent) : elem;
}
/**
 * transform whatever value is into an array of char strings
 */


function transformToCharString(value) {
  const ret = [];

  if (!Array.isArray(value)) {
    value = [value];
  }

  for (const val of value) {
    if (typeof val === 'string') {
      ret.push(...checkUnicode(val));
    } else if (typeof val === 'number') {
      const entry = `${val}`.split('');
      ret.push(...entry);
    } else if (val && typeof val === 'object') {
      try {
        ret.push(...JSON.stringify(val).split(''));
      } catch (e) {
        /* ignore */
      }
    } else if (typeof val === 'boolean') {
      const entry = val ? 'true'.split('') : 'false'.split('');
      ret.push(...entry);
    }
  }

  return ret;
}

function sanitizeCSS(value) {
  /* istanbul ignore next */
  if (!value) {
    return value;
  }

  return value.trim().replace(/'/g, '').replace(/"/g, '').toLowerCase();
}
/**
 * parse css values to a better format
 * @param  {Object} cssPropertyValue result of WebDriver call
 * @param  {String} cssProperty      name of css property to parse
 * @return {Object}                  parsed css property
 */


function parseCSS(cssPropertyValue, cssProperty) {
  if (!cssPropertyValue) {
    return null;
  }

  let parsedValue = {
    property: cssProperty,
    value: cssPropertyValue.toLowerCase().trim()
  };

  if (parsedValue.value.indexOf('rgb') === 0) {
    /**
     * remove whitespaces in rgb values
     */
    parsedValue.value = parsedValue.value.replace(/\s/g, '');
    /**
     * parse color values
     */

    let color = parsedValue.value;
    parsedValue.parsed = (0, _rgb2hex.default)(parsedValue.value);
    parsedValue.parsed.type = 'color';
    parsedValue.parsed[/[rgba]+/g.exec(color)[0]] = color;
  } else if (parsedValue.property === 'font-family') {
    let font = (0, _cssValue.default)(cssPropertyValue);
    let string = parsedValue.value;
    let value = cssPropertyValue.split(/,/).map(sanitizeCSS);
    parsedValue.value = sanitizeCSS(font[0].value || font[0].string);
    parsedValue.parsed = {
      value,
      type: 'font',
      string
    };
  } else {
    /**
     * parse other css properties
     */
    try {
      parsedValue.parsed = (0, _cssValue.default)(cssPropertyValue);

      if (parsedValue.parsed.length === 1) {
        parsedValue.parsed = parsedValue.parsed[0];
      }

      if (parsedValue.parsed.type && parsedValue.parsed.type === 'number' && parsedValue.parsed.unit === '') {
        parsedValue.value = parsedValue.parsed.value;
      }
    } catch (e) {// TODO improve css-parse lib to handle properties like
      // `-webkit-animation-timing-function :  cubic-bezier(0.25, 0.1, 0.25, 1)
    }
  }

  return parsedValue;
}
/**
 * check for unicode character or split string into literals
 * @param  {String} value  text
 * @return {Array}         set of characters or unicode symbols
 */


function checkUnicode(value) {
  return _constants.UNICODE_CHARACTERS.hasOwnProperty(value) ? [_constants.UNICODE_CHARACTERS[value]] : new _graphemeSplitter.default().splitGraphemes(value);
}

function fetchElementByJSFunction(selector, scope) {
  if (!scope.elementId) {
    return scope.execute(selector);
  }

  const script = (elem => selector.call(elem)).toString().replace('selector', `(${selector.toString()})`);

  return getBrowserObject(scope).execute(`return (${script}).apply(null, arguments)`, scope);
}
/**
 * logic to find an element
 */


async function findElement(selector) {
  /**
   * fetch element using regular protocol command
   */
  if (typeof selector === 'string') {
    const {
      using,
      value
    } = findStrategy(selector, this.isW3C);
    return this.elementId ? this.findElementFromElement(this.elementId, using, value) : this.findElement(using, value);
  }
  /**
   * fetch element with JS function
   */


  if (typeof selector === 'function') {
    const notFoundError = new Error(`Function selector "${selector.toString()}" did not return an HTMLElement`);
    let elem = await fetchElementByJSFunction(selector, this);
    elem = Array.isArray(elem) ? elem[0] : elem;
    return getElementFromResponse(elem) ? elem : notFoundError;
  }

  throw INVALID_SELECTOR_ERROR;
}
/**
 * logic to find a elements
 */


async function findElements(selector) {
  /**
   * fetch element using regular protocol command
   */
  if (typeof selector === 'string') {
    const {
      using,
      value
    } = findStrategy(selector, this.isW3C);
    return this.elementId ? this.findElementsFromElement(this.elementId, using, value) : this.findElements(using, value);
  }
  /**
   * fetch element with JS function
   */


  if (typeof selector === 'function') {
    let elems = await fetchElementByJSFunction(selector, this);
    elems = Array.isArray(elems) ? elems : [elems];
    return elems.filter(elem => elem && getElementFromResponse(elem));
  }

  throw INVALID_SELECTOR_ERROR;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlscy5qcyJdLCJuYW1lcyI6WyJERUZBVUxUX1NFTEVDVE9SIiwiRElSRUNUX1NFTEVDVE9SX1JFR0VYUCIsIklOVkFMSURfU0VMRUNUT1JfRVJST1IiLCJFcnJvciIsImZpbmRTdHJhdGVneSIsInZhbHVlIiwiaXNXM0MiLCJ1c2luZyIsIm1hdGNoIiwiVzNDX1NFTEVDVE9SX1NUUkFURUdJRVMiLCJpbmNsdWRlcyIsImluZGV4T2YiLCJzbGljZSIsInRvTG93ZXJDYXNlIiwic2VhcmNoIiwicmVwbGFjZSIsIlJlZ0V4cCIsIm1hcCIsInJ4Iiwic291cmNlIiwiam9pbiIsIlBSRUZJWF9OQU1FIiwiY29uZGl0aW9ucyIsInRhZyIsInByZWZpeCIsIm5hbWUiLCJhdHRyTmFtZSIsImF0dHJWYWx1ZSIsInBhcnRpYWwiLCJxdWVyeSIsInB1c2giLCJhcHBseVNjb3BlUHJvdG90eXBlIiwicHJvdG90eXBlIiwic2NvcGUiLCJkaXIiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsImZpbGVzIiwiZnMiLCJyZWFkZGlyU3luYyIsImZpbGVuYW1lIiwiY29tbWFuZE5hbWUiLCJiYXNlbmFtZSIsImV4dG5hbWUiLCJyZXF1aXJlIiwiZGVmYXVsdCIsImdldFByb3RvdHlwZSIsImdldEVsZW1lbnRGcm9tUmVzcG9uc2UiLCJyZXMiLCJFTEVNRU5UIiwiRUxFTUVOVF9LRVkiLCJtb2JpbGVEZXRlY3RvciIsImNhcHMiLCJpc01vYmlsZSIsIkJvb2xlYW4iLCJkZXZpY2VOYW1lIiwiYnJvd3Nlck5hbWUiLCJ1bmRlZmluZWQiLCJpc0lPUyIsInBsYXRmb3JtTmFtZSIsImlzQW5kcm9pZCIsImdldEJyb3dzZXJPYmplY3QiLCJlbGVtIiwicGFyZW50IiwidHJhbnNmb3JtVG9DaGFyU3RyaW5nIiwicmV0IiwiQXJyYXkiLCJpc0FycmF5IiwidmFsIiwiY2hlY2tVbmljb2RlIiwiZW50cnkiLCJzcGxpdCIsIkpTT04iLCJzdHJpbmdpZnkiLCJlIiwic2FuaXRpemVDU1MiLCJ0cmltIiwicGFyc2VDU1MiLCJjc3NQcm9wZXJ0eVZhbHVlIiwiY3NzUHJvcGVydHkiLCJwYXJzZWRWYWx1ZSIsInByb3BlcnR5IiwiY29sb3IiLCJwYXJzZWQiLCJ0eXBlIiwiZXhlYyIsImZvbnQiLCJzdHJpbmciLCJsZW5ndGgiLCJ1bml0IiwiVU5JQ09ERV9DSEFSQUNURVJTIiwiaGFzT3duUHJvcGVydHkiLCJHcmFwaGVtZVNwbGl0dGVyIiwic3BsaXRHcmFwaGVtZXMiLCJmZXRjaEVsZW1lbnRCeUpTRnVuY3Rpb24iLCJzZWxlY3RvciIsImVsZW1lbnRJZCIsImV4ZWN1dGUiLCJzY3JpcHQiLCJjYWxsIiwidG9TdHJpbmciLCJmaW5kRWxlbWVudCIsImZpbmRFbGVtZW50RnJvbUVsZW1lbnQiLCJub3RGb3VuZEVycm9yIiwiZmluZEVsZW1lbnRzIiwiZmluZEVsZW1lbnRzRnJvbUVsZW1lbnQiLCJlbGVtcyIsImZpbHRlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOzs7O0FBRUEsTUFBTUEsZ0JBQWdCLEdBQUcsY0FBekI7QUFDQSxNQUFNQyxzQkFBc0IsR0FBRyw0SUFBL0I7QUFDQSxNQUFNQyxzQkFBc0IsR0FBRyxJQUFJQyxLQUFKLENBQVUsb0RBQVYsQ0FBL0I7O0FBRU8sTUFBTUMsWUFBWSxHQUFHLFVBQVVDLEtBQVYsRUFBaUJDLEtBQWpCLEVBQXdCO0FBQ2hEOzs7QUFHQSxNQUFJQyxLQUFLLEdBQUdQLGdCQUFaO0FBRUE7Ozs7QUFHQSxRQUFNUSxLQUFLLEdBQUdILEtBQUssQ0FBQ0csS0FBTixDQUFZUCxzQkFBWixDQUFkOztBQUNBLE1BQUlPLEtBQUosRUFBVztBQUNQOzs7QUFHQSxRQUFJRixLQUFLLElBQUksQ0FBQ0csbUNBQXdCQyxRQUF4QixDQUFpQ0YsS0FBSyxDQUFDLENBQUQsQ0FBdEMsQ0FBZCxFQUEwRDtBQUN0RCxZQUFNLElBQUlMLEtBQUosQ0FBVSx5QkFBVixDQUFO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TCxJQUFkLElBQXNCQSxJQUFJLENBQUMsQ0FBRCxDQUExQixHQUFnQ0EsSUFBdkM7QUFDQSxXQUFPZixzQkFBc0IsQ0FBQ2UsSUFBRCxDQUF0QixHQUErQkEsSUFBL0IsR0FBc0N5QyxhQUE3QztBQUNIOztBQUVELFFBQU10RyxzQkFBTjtBQUNIO0FBRUQ7Ozs7O0FBR08sZUFBZXVHLFlBQWYsQ0FBNEJULFFBQTVCLEVBQXNDO0FBQ3pDOzs7QUFHQSxNQUFJLE9BQU9BLFFBQVAsS0FBb0IsUUFBeEIsRUFBa0M7QUFDOUIsVUFBTTtBQUFFekYsTUFBQUEsS0FBRjtBQUFTRixNQUFBQTtBQUFULFFBQW1CRCxZQUFZLENBQUM0RixRQUFELEVBQVcsS0FBSzFGLEtBQWhCLENBQXJDO0FBQ0EsV0FBTyxLQUFLMkYsU0FBTCxHQUNELEtBQUtTLHVCQUFMLENBQTZCLEtBQUtULFNBQWxDLEVBQTZDMUYsS0FBN0MsRUFBb0RGLEtBQXBELENBREMsR0FFRCxLQUFLb0csWUFBTCxDQUFrQmxHLEtBQWxCLEVBQXlCRixLQUF6QixDQUZOO0FBR0g7QUFFRDs7Ozs7QUFHQSxNQUFJLE9BQU8yRixRQUFQLEtBQW9CLFVBQXhCLEVBQW9DO0FBQ2hDLFFBQUlXLEtBQUssR0FBRyxNQUFNWix3QkFBd0IsQ0FBQ0MsUUFBRCxFQUFXLElBQVgsQ0FBMUM7QUFDQVcsSUFBQUEsS0FBSyxHQUFHeEMsS0FBSyxDQUFDQyxPQUFOLENBQWN1QyxLQUFkLElBQXVCQSxLQUF2QixHQUErQixDQUFDQSxLQUFELENBQXZDO0FBQ0EsV0FBT0EsS0FBSyxDQUFDQyxNQUFOLENBQWM3QyxJQUFELElBQVVBLElBQUksSUFBSWYsc0JBQXNCLENBQUNlLElBQUQsQ0FBckQsQ0FBUDtBQUNIOztBQUVELFFBQU03RCxzQkFBTjtBQUNIIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gJ2ZzJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCBjc3NWYWx1ZSBmcm9tICdjc3MtdmFsdWUnXG5pbXBvcnQgcmdiMmhleCBmcm9tICdyZ2IyaGV4J1xuaW1wb3J0IEdyYXBoZW1lU3BsaXR0ZXIgZnJvbSAnZ3JhcGhlbWUtc3BsaXR0ZXInXG5cbmltcG9ydCB7IEVMRU1FTlRfS0VZLCBXM0NfU0VMRUNUT1JfU1RSQVRFR0lFUywgVU5JQ09ERV9DSEFSQUNURVJTIH0gZnJvbSAnLi9jb25zdGFudHMnXG5cbmNvbnN0IERFRkFVTFRfU0VMRUNUT1IgPSAnY3NzIHNlbGVjdG9yJ1xuY29uc3QgRElSRUNUX1NFTEVDVE9SX1JFR0VYUCA9IC9eKGlkfGNzcyBzZWxlY3Rvcnx4cGF0aHxsaW5rIHRleHR8cGFydGlhbCBsaW5rIHRleHR8bmFtZXx0YWcgbmFtZXxjbGFzcyBuYW1lfC1hbmRyb2lkIHVpYXV0b21hdG9yfC1pb3MgdWlhdXRvbWF0aW9ufGFjY2Vzc2liaWxpdHkgaWQpOiguKykvXG5jb25zdCBJTlZBTElEX1NFTEVDVE9SX0VSUk9SID0gbmV3IEVycm9yKCdzZWxlY3RvciBuZWVkcyB0byBiZSB0eXBlb2YgYHN0cmluZ2Agb3IgYGZ1bmN0aW9uYCcpXG5cbmV4cG9ydCBjb25zdCBmaW5kU3RyYXRlZ3kgPSBmdW5jdGlvbiAodmFsdWUsIGlzVzNDKSB7XG4gICAgLyoqXG4gICAgICogc2V0IGRlZmF1bHQgc2VsZWN0b3JcbiAgICAgKi9cbiAgICBsZXQgdXNpbmcgPSBERUZBVUxUX1NFTEVDVE9SXG5cbiAgICAvKipcbiAgICAgKiBjaGVjayBpZiB1c2VyIGhhcyBzcGVjaWZpZWQgbG9jYXRvciBzdHJhdGVneSBkaXJlY3RseVxuICAgICAqL1xuICAgIGNvbnN0IG1hdGNoID0gdmFsdWUubWF0Y2goRElSRUNUX1NFTEVDVE9SX1JFR0VYUClcbiAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGVuc3VyZSBzZWxlY3RvciBzdHJhdGVneSBpcyBzdXBwb3J0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGlmIChpc1czQyAmJiAhVzNDX1NFTEVDVE9SX1NUUkFURUdJRVMuaW5jbHVkZXMobWF0Y2hbMV0pKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWRTZWxlY3RvclN0cmF0ZWd5JykgLy8gVG9EbzogbW92ZSBlcnJvciB0byB3ZGlvLWVycm9yIHBhY2thZ2VcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB1c2luZzogbWF0Y2hbMV0sXG4gICAgICAgICAgICB2YWx1ZTogbWF0Y2hbMl1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHVzZSB4UGF0aCBzdHJhdGVneSBpZiB2YWx1ZSBzdGFydHMgd2l0aCAvL1xuICAgIGlmICh2YWx1ZS5pbmRleE9mKCcvJykgPT09IDAgfHwgdmFsdWUuaW5kZXhPZignKCcpID09PSAwIHx8XG4gICAgICAgICAgICAgICB2YWx1ZS5pbmRleE9mKCcuLi8nKSA9PT0gMCB8fCB2YWx1ZS5pbmRleE9mKCcuLycpID09PSAwIHx8XG4gICAgICAgICAgICAgICB2YWx1ZS5pbmRleE9mKCcqLycpID09PSAwKSB7XG4gICAgICAgIHVzaW5nID0gJ3hwYXRoJ1xuXG4gICAgLy8gdXNlIGxpbmsgdGV4dCBzdHJhdGVneSBpZiB2YWx1ZSBzdGFydHMgd2l0aCA9XG4gICAgfSBlbHNlIGlmICh2YWx1ZS5pbmRleE9mKCc9JykgPT09IDApIHtcbiAgICAgICAgdXNpbmcgPSAnbGluayB0ZXh0J1xuICAgICAgICB2YWx1ZSA9IHZhbHVlLnNsaWNlKDEpXG5cbiAgICAvLyB1c2UgcGFydGlhbCBsaW5rIHRleHQgc3RyYXRlZ3kgaWYgdmFsdWUgc3RhcnRzIHdpdGggKj1cbiAgICB9IGVsc2UgaWYgKHZhbHVlLmluZGV4T2YoJyo9JykgPT09IDApIHtcbiAgICAgICAgdXNpbmcgPSAncGFydGlhbCBsaW5rIHRleHQnXG4gICAgICAgIHZhbHVlID0gdmFsdWUuc2xpY2UoMilcblxuICAgIC8vIHJlY3Vyc2l2ZSBlbGVtZW50IHNlYXJjaCB1c2luZyB0aGUgVWlBdXRvbWF0b3IgbGlicmFyeSAoQW5kcm9pZCBvbmx5KVxuICAgIH0gZWxzZSBpZiAodmFsdWUuaW5kZXhPZignYW5kcm9pZD0nKSA9PT0gMCkge1xuICAgICAgICB1c2luZyA9ICctYW5kcm9pZCB1aWF1dG9tYXRvcidcbiAgICAgICAgdmFsdWUgPSB2YWx1ZS5zbGljZSg4KVxuXG4gICAgLy8gcmVjdXJzaXZlIGVsZW1lbnQgc2VhcmNoIHVzaW5nIHRoZSBVSUF1dG9tYXRpb24gbGlicmFyeSAoaU9TLW9ubHkpXG4gICAgfSBlbHNlIGlmICh2YWx1ZS5pbmRleE9mKCdpb3M9JykgPT09IDApIHtcbiAgICAgICAgdXNpbmcgPSAnLWlvcyB1aWF1dG9tYXRpb24nXG4gICAgICAgIHZhbHVlID0gdmFsdWUuc2xpY2UoNClcblxuICAgIC8vIHJlY3Vyc2l2ZSBlbGVtZW50IHNlYXJjaCB1c2luZyBhY2Nlc3NpYmlsaXR5IGlkXG4gICAgfSBlbHNlIGlmICh2YWx1ZS5pbmRleE9mKCd+JykgPT09IDApIHtcbiAgICAgICAgdXNpbmcgPSAnYWNjZXNzaWJpbGl0eSBpZCdcbiAgICAgICAgdmFsdWUgPSB2YWx1ZS5zbGljZSgxKVxuXG4gICAgLy8gY2xhc3MgbmFtZSBtb2JpbGUgc2VsZWN0b3JcbiAgICAvLyBmb3IgaU9TID0gVUlBLi4uXG4gICAgLy8gZm9yIEFuZHJvaWQgPSBhbmRyb2lkLndpZGdldFxuICAgIH0gZWxzZSBpZiAodmFsdWUuc2xpY2UoMCwgMykgPT09ICdVSUEnIHx8IHZhbHVlLnNsaWNlKDAsIDE1KSA9PT0gJ1hDVUlFbGVtZW50VHlwZScgfHwgdmFsdWUuc2xpY2UoMCwgMTQpLnRvTG93ZXJDYXNlKCkgPT09ICdhbmRyb2lkLndpZGdldCcpIHtcbiAgICAgICAgdXNpbmcgPSAnY2xhc3MgbmFtZSdcblxuICAgIC8vIHVzZSB0YWcgbmFtZSBzdHJhdGVneSBpZiB2YWx1ZSBjb250YWlucyBhIHRhZ1xuICAgIC8vIGUuZy4gXCI8ZGl2PlwiIG9yIFwiPGRpdiAvPlwiXG4gICAgfSBlbHNlIGlmICh2YWx1ZS5zZWFyY2goLzxbYS16QS1aLV0rKCBcXC8pKj4vZykgPj0gMCkge1xuICAgICAgICB1c2luZyA9ICd0YWcgbmFtZSdcbiAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC88fD58XFwvfFxccy9nLCAnJylcblxuICAgIC8vIHVzZSBuYW1lIHN0cmF0ZWd5IGlmIHZhbHVlIHF1ZXJpZXMgZWxlbWVudHMgd2l0aCBuYW1lIGF0dHJpYnV0ZXNcbiAgICAvLyBlLmcuIFwiW25hbWU9J215TmFtZSddXCIgb3IgJ1tuYW1lPVwibXlOYW1lXCJdJ1xuICAgIH0gZWxzZSBpZiAodmFsdWUuc2VhcmNoKC9eXFxbbmFtZT0oXCJ8JykoW2EtekEtejAtOVxcLV8uIF0rKShcInwnKV0kLykgPj0gMCkge1xuICAgICAgICB1c2luZyA9ICduYW1lJ1xuICAgICAgICB2YWx1ZSA9IHZhbHVlLm1hdGNoKC9eXFxbbmFtZT0oXCJ8JykoW2EtekEtejAtOVxcLV8uIF0rKShcInwnKV0kLylbMl1cblxuXG4gICAgLy8gYWxsb3cgdG8gbW92ZSB1cCB0byB0aGUgcGFyZW50IG9yIHNlbGVjdCBjdXJyZW50IGVsZW1lbnRcbiAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAnLi4nIHx8IHZhbHVlID09PSAnLicpIHtcbiAgICAgICAgdXNpbmcgPSAneHBhdGgnXG5cbiAgICAvLyBhbnkgZWxlbWVudCB3aXRoIGdpdmVuIGNsYXNzLCBpZCwgb3IgYXR0cmlidXRlIGFuZCBjb250ZW50XG4gICAgLy8gZS5nLiBoMS5oZWFkZXI9V2VsY29tZSBvciBbZGF0YS1uYW1lPXRhYmxlLXJvd109SXRlbSBvciAjY29udGVudCo9SW50cm9cbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBtYXRjaCA9IHZhbHVlLm1hdGNoKG5ldyBSZWdFeHAoW1xuICAgICAgICAgICAgLy8gSFRNTCB0YWdcbiAgICAgICAgICAgIC9eKFthLXowLTldKikvLFxuICAgICAgICAgICAgLy8gb3B0aW9uYWwgLiBvciAjICsgY2xhc3Mgb3IgaWRcbiAgICAgICAgICAgIC8oPzooXFwufCMpKC0/W19hLXpBLVpdK1tfYS16QS1aMC05LV0qKSk/LyxcbiAgICAgICAgICAgIC8vIG9wdGlvbmFsIFthdHRyaWJ1dGUtbmFtZT1cImF0dHJpYnV0ZS12YWx1ZVwiXVxuICAgICAgICAgICAgLyg/OlxcWygtP1tfYS16QS1aXStbX2EtekEtWjAtOS1dKikoPzo9KD86XCJ8JykoW2EtekEtejAtOVxcLV8uIF0rKSg/OlwifCcpKT9cXF0pPy8sXG4gICAgICAgICAgICAvLyAqPXF1ZXJ5IG9yID1xdWVyeVxuICAgICAgICAgICAgLyhcXCopPz0oLispJC8sXG4gICAgICAgIF0ubWFwKHJ4ID0+IHJ4LnNvdXJjZSkuam9pbignJykpKVxuXG4gICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgY29uc3QgUFJFRklYX05BTUUgPSB7ICcuJzogJ2NsYXNzJywgJyMnOiAnaWQnIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBbXVxuICAgICAgICAgICAgY29uc3QgW1xuICAgICAgICAgICAgICAgIHRhZyxcbiAgICAgICAgICAgICAgICBwcmVmaXgsIG5hbWUsXG4gICAgICAgICAgICAgICAgYXR0ck5hbWUsIGF0dHJWYWx1ZSxcbiAgICAgICAgICAgICAgICBwYXJ0aWFsLCBxdWVyeVxuICAgICAgICAgICAgXSA9ICBtYXRjaC5zbGljZSgxKVxuXG4gICAgICAgICAgICBpZiAocHJlZml4KSB7XG4gICAgICAgICAgICAgICAgY29uZGl0aW9ucy5wdXNoKGBjb250YWlucyhAJHtQUkVGSVhfTkFNRVtwcmVmaXhdfSwgXCIke25hbWV9XCIpYClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhdHRyTmFtZSkge1xuICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgYXR0clZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGBjb250YWlucyhAJHthdHRyTmFtZX0sIFwiJHthdHRyVmFsdWV9XCIpYFxuICAgICAgICAgICAgICAgICAgICAgICAgOiBgQCR7YXR0ck5hbWV9YFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGFydGlhbCkge1xuICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMucHVzaChgY29udGFpbnMoLiwgXCIke3F1ZXJ5fVwiKWApXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMucHVzaChgbm9ybWFsaXplLXNwYWNlKCkgPSBcIiR7cXVlcnl9XCJgKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB1c2luZyA9ICd4cGF0aCdcbiAgICAgICAgICAgIHZhbHVlID0gYC4vLyR7dGFnIHx8ICcqJ31bJHtjb25kaXRpb25zLmpvaW4oJyBhbmQgJyl9XWBcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGVuc3VyZSBzZWxlY3RvciBzdHJhdGVneSBpcyBzdXBwb3J0ZWRcbiAgICAgKi9cbiAgICBpZiAoaXNXM0MgJiYgIVczQ19TRUxFQ1RPUl9TVFJBVEVHSUVTLmluY2x1ZGVzKHVzaW5nKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWRTZWxlY3RvclN0cmF0ZWd5JykgLy8gVG9EbzogbW92ZSBlcnJvciB0byB3ZGlvLWVycm9yIHBhY2thZ2VcbiAgICB9XG5cbiAgICByZXR1cm4geyB1c2luZywgdmFsdWUgfVxufVxuXG5jb25zdCBhcHBseVNjb3BlUHJvdG90eXBlID0gKHByb3RvdHlwZSwgc2NvcGUpID0+IHtcbiAgICBjb25zdCBkaXIgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnY29tbWFuZHMnLCBzY29wZSlcbiAgICBjb25zdCBmaWxlcyA9IGZzLnJlYWRkaXJTeW5jKGRpcilcbiAgICBmb3IgKGxldCBmaWxlbmFtZSBvZiBmaWxlcykge1xuICAgICAgICBjb25zdCBjb21tYW5kTmFtZSA9IHBhdGguYmFzZW5hbWUoZmlsZW5hbWUsIHBhdGguZXh0bmFtZShmaWxlbmFtZSkpXG4gICAgICAgIHByb3RvdHlwZVtjb21tYW5kTmFtZV0gPSB7IHZhbHVlOiByZXF1aXJlKHBhdGguam9pbihkaXIsIGNvbW1hbmROYW1lKSkuZGVmYXVsdCB9XG4gICAgfVxufVxuXG4vKipcbiAqIGVuaGFuY2VzIG9iamVjdHMgd2l0aCBlbGVtZW50IGNvbW1hbmRzXG4gKi9cbmV4cG9ydCBjb25zdCBnZXRQcm90b3R5cGUgPSAoc2NvcGUpID0+IHtcbiAgICBjb25zdCBwcm90b3R5cGUgPSB7fVxuXG4gICAgLyoqXG4gICAgICogcmVnaXN0ZXIgYWN0aW9uIGNvbW1hbmRzXG4gICAgICovXG4gICAgYXBwbHlTY29wZVByb3RvdHlwZShwcm90b3R5cGUsIHNjb3BlKVxuICAgIHJldHVybiBwcm90b3R5cGVcbn1cblxuLyoqXG4gKiBnZXQgZWxlbWVudCBpZCBmcm9tIFdlYkRyaXZlciByZXNwb25zZVxuICogQHBhcmFtICB7b2JqZWN0fSByZXMgICAgICAgICBib2R5IG9iamVjdCBmcm9tIHJlc3BvbnNlXG4gKiBAcmV0dXJuIHtzdHJpbmd8dW5kZWZpbmVkfSAgIGVsZW1lbnQgaWQgb3IgbnVsbCBpZiBlbGVtZW50IGNvdWxkbid0IGJlIGZvdW5kXG4gKi9cbmV4cG9ydCBjb25zdCBnZXRFbGVtZW50RnJvbVJlc3BvbnNlID0gKHJlcykgPT4ge1xuICAgIC8qKlxuICAgICAqIGRlcHJlY2F0ZWQgSlNPTldpcmVQcm90b2NvbCByZXNwb25zZVxuICAgICAqL1xuICAgIGlmIChyZXMuRUxFTUVOVCkge1xuICAgICAgICByZXR1cm4gcmVzLkVMRU1FTlRcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBXM0MgV2ViRHJpdmVyIHJlc3BvbnNlXG4gICAgICovXG4gICAgaWYgKHJlc1tFTEVNRU5UX0tFWV0pIHtcbiAgICAgICAgcmV0dXJuIHJlc1tFTEVNRU5UX0tFWV1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbFxufVxuXG4vKipcbiAqIGNoZWNrIGlmIGN1cnJlbnQgcGxhdGZvcm0gaXMgbW9iaWxlIGRldmljZVxuICpcbiAqIEBwYXJhbSAge09iamVjdH0gIGNhcHMgIGNhcGFiaWxpdGllc1xuICogQHJldHVybiB7Qm9vbGVhbn0gICAgICAgdHJ1ZSBpZiBwbGF0Zm9ybSBpcyBtb2JpbGUgZGV2aWNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtb2JpbGVEZXRlY3RvciAoY2Fwcykge1xuICAgIGxldCBpc01vYmlsZSA9IEJvb2xlYW4oXG4gICAgICAgICh0eXBlb2YgY2Fwc1snYXBwaXVtLXZlcnNpb24nXSAhPT0gJ3VuZGVmaW5lZCcpIHx8XG4gICAgICAgICh0eXBlb2YgY2Fwc1snZGV2aWNlLXR5cGUnXSAhPT0gJ3VuZGVmaW5lZCcpIHx8ICh0eXBlb2YgY2Fwc1snZGV2aWNlVHlwZSddICE9PSAndW5kZWZpbmVkJykgfHxcbiAgICAgICAgKHR5cGVvZiBjYXBzWydkZXZpY2Utb3JpZW50YXRpb24nXSAhPT0gJ3VuZGVmaW5lZCcpIHx8ICh0eXBlb2YgY2Fwc1snZGV2aWNlT3JpZW50YXRpb24nXSAhPT0gJ3VuZGVmaW5lZCcpIHx8XG4gICAgICAgICh0eXBlb2YgY2Fwcy5kZXZpY2VOYW1lICE9PSAndW5kZWZpbmVkJykgfHxcbiAgICAgICAgLy8gQ2hlY2sgYnJvd3Nlck5hbWUgZm9yIHNwZWNpZmljIHZhbHVlc1xuICAgICAgICAoY2Fwcy5icm93c2VyTmFtZSA9PT0gJycgfHxcbiAgICAgICAgICAgICAoY2Fwcy5icm93c2VyTmFtZSAhPT0gdW5kZWZpbmVkICYmIChjYXBzLmJyb3dzZXJOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpcGFkJyB8fCBjYXBzLmJyb3dzZXJOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpcGhvbmUnIHx8IGNhcHMuYnJvd3Nlck5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2FuZHJvaWQnKSkpXG4gICAgKVxuXG4gICAgbGV0IGlzSU9TID0gQm9vbGVhbihcbiAgICAgICAgKGNhcHMucGxhdGZvcm1OYW1lICYmIGNhcHMucGxhdGZvcm1OYW1lLm1hdGNoKC9pT1MvaSkpIHx8XG4gICAgICAgIChjYXBzLmRldmljZU5hbWUgJiYgY2Fwcy5kZXZpY2VOYW1lLm1hdGNoKC8oaVBhZHxpUGhvbmUpL2kpKVxuICAgIClcblxuICAgIGxldCBpc0FuZHJvaWQgPSBCb29sZWFuKFxuICAgICAgICAoY2Fwcy5wbGF0Zm9ybU5hbWUgJiYgY2Fwcy5wbGF0Zm9ybU5hbWUubWF0Y2goL0FuZHJvaWQvaSkpIHx8XG4gICAgICAgIChjYXBzLmJyb3dzZXJOYW1lICYmIGNhcHMuYnJvd3Nlck5hbWUubWF0Y2goL0FuZHJvaWQvaSkpXG4gICAgKVxuXG4gICAgcmV0dXJuIHsgaXNNb2JpbGUsIGlzSU9TLCBpc0FuZHJvaWQgfVxufVxuXG4vKipcbiAqIHRyYXZlcnNlIHVwIHRoZSBzY29wZSBjaGFpbiB1bnRpbCBicm93c2VyIGVsZW1lbnQgd2FzIHJlYWNoZWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEJyb3dzZXJPYmplY3QgKGVsZW0pIHtcbiAgICByZXR1cm4gZWxlbS5wYXJlbnQgPyBnZXRCcm93c2VyT2JqZWN0KGVsZW0ucGFyZW50KSA6IGVsZW1cbn1cblxuLyoqXG4gKiB0cmFuc2Zvcm0gd2hhdGV2ZXIgdmFsdWUgaXMgaW50byBhbiBhcnJheSBvZiBjaGFyIHN0cmluZ3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRyYW5zZm9ybVRvQ2hhclN0cmluZyAodmFsdWUpIHtcbiAgICBjb25zdCByZXQgPSBbXVxuXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICB2YWx1ZSA9IFt2YWx1ZV1cbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IHZhbCBvZiB2YWx1ZSkge1xuICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldC5wdXNoKC4uLmNoZWNrVW5pY29kZSh2YWwpKVxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWwgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBjb25zdCBlbnRyeSA9IGAke3ZhbH1gLnNwbGl0KCcnKVxuICAgICAgICAgICAgcmV0LnB1c2goLi4uZW50cnkpXG4gICAgICAgIH0gZWxzZSBpZiAodmFsICYmIHR5cGVvZiB2YWwgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJldC5wdXNoKC4uLkpTT04uc3RyaW5naWZ5KHZhbCkuc3BsaXQoJycpKVxuICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyAvKiBpZ25vcmUgKi8gfVxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWwgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgY29uc3QgZW50cnkgPSB2YWwgPyAndHJ1ZScuc3BsaXQoJycpIDogJ2ZhbHNlJy5zcGxpdCgnJylcbiAgICAgICAgICAgIHJldC5wdXNoKC4uLmVudHJ5KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJldFxufVxuXG5mdW5jdGlvbiBzYW5pdGl6ZUNTUyAodmFsdWUpIHtcbiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlXG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlLnRyaW0oKS5yZXBsYWNlKC8nL2csICcnKS5yZXBsYWNlKC9cIi9nLCAnJykudG9Mb3dlckNhc2UoKVxufVxuXG4vKipcbiAqIHBhcnNlIGNzcyB2YWx1ZXMgdG8gYSBiZXR0ZXIgZm9ybWF0XG4gKiBAcGFyYW0gIHtPYmplY3R9IGNzc1Byb3BlcnR5VmFsdWUgcmVzdWx0IG9mIFdlYkRyaXZlciBjYWxsXG4gKiBAcGFyYW0gIHtTdHJpbmd9IGNzc1Byb3BlcnR5ICAgICAgbmFtZSBvZiBjc3MgcHJvcGVydHkgdG8gcGFyc2VcbiAqIEByZXR1cm4ge09iamVjdH0gICAgICAgICAgICAgICAgICBwYXJzZWQgY3NzIHByb3BlcnR5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUNTUyAoY3NzUHJvcGVydHlWYWx1ZSwgY3NzUHJvcGVydHkpIHtcbiAgICBpZiAoIWNzc1Byb3BlcnR5VmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG5cbiAgICBsZXQgcGFyc2VkVmFsdWUgPSB7XG4gICAgICAgIHByb3BlcnR5OiBjc3NQcm9wZXJ0eSxcbiAgICAgICAgdmFsdWU6IGNzc1Byb3BlcnR5VmFsdWUudG9Mb3dlckNhc2UoKS50cmltKClcbiAgICB9XG5cbiAgICBpZiAocGFyc2VkVmFsdWUudmFsdWUuaW5kZXhPZigncmdiJykgPT09IDApIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHJlbW92ZSB3aGl0ZXNwYWNlcyBpbiByZ2IgdmFsdWVzXG4gICAgICAgICAqL1xuICAgICAgICBwYXJzZWRWYWx1ZS52YWx1ZSA9IHBhcnNlZFZhbHVlLnZhbHVlLnJlcGxhY2UoL1xccy9nLCAnJylcblxuICAgICAgICAvKipcbiAgICAgICAgICogcGFyc2UgY29sb3IgdmFsdWVzXG4gICAgICAgICAqL1xuICAgICAgICBsZXQgY29sb3IgPSBwYXJzZWRWYWx1ZS52YWx1ZVxuICAgICAgICBwYXJzZWRWYWx1ZS5wYXJzZWQgPSByZ2IyaGV4KHBhcnNlZFZhbHVlLnZhbHVlKVxuICAgICAgICBwYXJzZWRWYWx1ZS5wYXJzZWQudHlwZSA9ICdjb2xvcidcbiAgICAgICAgcGFyc2VkVmFsdWUucGFyc2VkWy9bcmdiYV0rL2cuZXhlYyhjb2xvcilbMF1dID0gY29sb3JcbiAgICB9IGVsc2UgaWYgKHBhcnNlZFZhbHVlLnByb3BlcnR5ID09PSAnZm9udC1mYW1pbHknKSB7XG4gICAgICAgIGxldCBmb250ID0gY3NzVmFsdWUoY3NzUHJvcGVydHlWYWx1ZSlcbiAgICAgICAgbGV0IHN0cmluZyA9IHBhcnNlZFZhbHVlLnZhbHVlXG4gICAgICAgIGxldCB2YWx1ZSA9IGNzc1Byb3BlcnR5VmFsdWUuc3BsaXQoLywvKS5tYXAoc2FuaXRpemVDU1MpXG5cbiAgICAgICAgcGFyc2VkVmFsdWUudmFsdWUgPSBzYW5pdGl6ZUNTUyhmb250WzBdLnZhbHVlIHx8IGZvbnRbMF0uc3RyaW5nKVxuICAgICAgICBwYXJzZWRWYWx1ZS5wYXJzZWQgPSB7IHZhbHVlLCB0eXBlOiAnZm9udCcsIHN0cmluZyB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHBhcnNlIG90aGVyIGNzcyBwcm9wZXJ0aWVzXG4gICAgICAgICAqL1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcGFyc2VkVmFsdWUucGFyc2VkID0gY3NzVmFsdWUoY3NzUHJvcGVydHlWYWx1ZSlcblxuICAgICAgICAgICAgaWYgKHBhcnNlZFZhbHVlLnBhcnNlZC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBwYXJzZWRWYWx1ZS5wYXJzZWQgPSBwYXJzZWRWYWx1ZS5wYXJzZWRbMF1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBhcnNlZFZhbHVlLnBhcnNlZC50eXBlICYmIHBhcnNlZFZhbHVlLnBhcnNlZC50eXBlID09PSAnbnVtYmVyJyAmJiBwYXJzZWRWYWx1ZS5wYXJzZWQudW5pdCA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICBwYXJzZWRWYWx1ZS52YWx1ZSA9IHBhcnNlZFZhbHVlLnBhcnNlZC52YWx1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBUT0RPIGltcHJvdmUgY3NzLXBhcnNlIGxpYiB0byBoYW5kbGUgcHJvcGVydGllcyBsaWtlXG4gICAgICAgICAgICAvLyBgLXdlYmtpdC1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uIDogIGN1YmljLWJlemllcigwLjI1LCAwLjEsIDAuMjUsIDEpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcGFyc2VkVmFsdWVcbn1cblxuLyoqXG4gKiBjaGVjayBmb3IgdW5pY29kZSBjaGFyYWN0ZXIgb3Igc3BsaXQgc3RyaW5nIGludG8gbGl0ZXJhbHNcbiAqIEBwYXJhbSAge1N0cmluZ30gdmFsdWUgIHRleHRcbiAqIEByZXR1cm4ge0FycmF5fSAgICAgICAgIHNldCBvZiBjaGFyYWN0ZXJzIG9yIHVuaWNvZGUgc3ltYm9sc1xuICovXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tVbmljb2RlICh2YWx1ZSkge1xuICAgIHJldHVybiBVTklDT0RFX0NIQVJBQ1RFUlMuaGFzT3duUHJvcGVydHkodmFsdWUpID8gW1VOSUNPREVfQ0hBUkFDVEVSU1t2YWx1ZV1dIDogbmV3IEdyYXBoZW1lU3BsaXR0ZXIoKS5zcGxpdEdyYXBoZW1lcyh2YWx1ZSlcbn1cblxuZnVuY3Rpb24gZmV0Y2hFbGVtZW50QnlKU0Z1bmN0aW9uIChzZWxlY3Rvciwgc2NvcGUpIHtcbiAgICBpZiAoIXNjb3BlLmVsZW1lbnRJZCkge1xuICAgICAgICByZXR1cm4gc2NvcGUuZXhlY3V0ZShzZWxlY3RvcilcbiAgICB9XG5cbiAgICBjb25zdCBzY3JpcHQgPSAoKGVsZW0pID0+IChzZWxlY3RvcikuY2FsbChlbGVtKSkudG9TdHJpbmcoKS5yZXBsYWNlKCdzZWxlY3RvcicsIGAoJHtzZWxlY3Rvci50b1N0cmluZygpfSlgKVxuICAgIHJldHVybiBnZXRCcm93c2VyT2JqZWN0KHNjb3BlKS5leGVjdXRlKGByZXR1cm4gKCR7c2NyaXB0fSkuYXBwbHkobnVsbCwgYXJndW1lbnRzKWAsIHNjb3BlKVxufVxuXG4vKipcbiAqIGxvZ2ljIHRvIGZpbmQgYW4gZWxlbWVudFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluZEVsZW1lbnQoc2VsZWN0b3IpIHtcbiAgICAvKipcbiAgICAgKiBmZXRjaCBlbGVtZW50IHVzaW5nIHJlZ3VsYXIgcHJvdG9jb2wgY29tbWFuZFxuICAgICAqL1xuICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGNvbnN0IHsgdXNpbmcsIHZhbHVlIH0gPSBmaW5kU3RyYXRlZ3koc2VsZWN0b3IsIHRoaXMuaXNXM0MpXG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRJZFxuICAgICAgICAgICAgPyB0aGlzLmZpbmRFbGVtZW50RnJvbUVsZW1lbnQodGhpcy5lbGVtZW50SWQsIHVzaW5nLCB2YWx1ZSlcbiAgICAgICAgICAgIDogdGhpcy5maW5kRWxlbWVudCh1c2luZywgdmFsdWUpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogZmV0Y2ggZWxlbWVudCB3aXRoIEpTIGZ1bmN0aW9uXG4gICAgICovXG4gICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IEVycm9yKGBGdW5jdGlvbiBzZWxlY3RvciBcIiR7c2VsZWN0b3IudG9TdHJpbmcoKX1cIiBkaWQgbm90IHJldHVybiBhbiBIVE1MRWxlbWVudGApXG4gICAgICAgIGxldCBlbGVtID0gYXdhaXQgZmV0Y2hFbGVtZW50QnlKU0Z1bmN0aW9uKHNlbGVjdG9yLCB0aGlzKVxuICAgICAgICBlbGVtID0gQXJyYXkuaXNBcnJheShlbGVtKSA/IGVsZW1bMF0gOiBlbGVtXG4gICAgICAgIHJldHVybiBnZXRFbGVtZW50RnJvbVJlc3BvbnNlKGVsZW0pID8gZWxlbSA6IG5vdEZvdW5kRXJyb3JcbiAgICB9XG5cbiAgICB0aHJvdyBJTlZBTElEX1NFTEVDVE9SX0VSUk9SXG59XG5cbi8qKlxuICogbG9naWMgdG8gZmluZCBhIGVsZW1lbnRzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kRWxlbWVudHMoc2VsZWN0b3IpIHtcbiAgICAvKipcbiAgICAgKiBmZXRjaCBlbGVtZW50IHVzaW5nIHJlZ3VsYXIgcHJvdG9jb2wgY29tbWFuZFxuICAgICAqL1xuICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGNvbnN0IHsgdXNpbmcsIHZhbHVlIH0gPSBmaW5kU3RyYXRlZ3koc2VsZWN0b3IsIHRoaXMuaXNXM0MpXG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRJZFxuICAgICAgICAgICAgPyB0aGlzLmZpbmRFbGVtZW50c0Zyb21FbGVtZW50KHRoaXMuZWxlbWVudElkLCB1c2luZywgdmFsdWUpXG4gICAgICAgICAgICA6IHRoaXMuZmluZEVsZW1lbnRzKHVzaW5nLCB2YWx1ZSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBmZXRjaCBlbGVtZW50IHdpdGggSlMgZnVuY3Rpb25cbiAgICAgKi9cbiAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGxldCBlbGVtcyA9IGF3YWl0IGZldGNoRWxlbWVudEJ5SlNGdW5jdGlvbihzZWxlY3RvciwgdGhpcylcbiAgICAgICAgZWxlbXMgPSBBcnJheS5pc0FycmF5KGVsZW1zKSA/IGVsZW1zIDogW2VsZW1zXVxuICAgICAgICByZXR1cm4gZWxlbXMuZmlsdGVyKChlbGVtKSA9PiBlbGVtICYmIGdldEVsZW1lbnRGcm9tUmVzcG9uc2UoZWxlbSkpXG4gICAgfVxuXG4gICAgdGhyb3cgSU5WQUxJRF9TRUxFQ1RPUl9FUlJPUlxufVxuIl19