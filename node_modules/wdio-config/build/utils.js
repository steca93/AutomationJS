'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _sourceMapSupport2 = require('source-map-support');

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

exports.detectBackend = detectBackend;
exports.initialisePlugin = initialisePlugin;
exports.validateConfig = validateConfig;
(0, _sourceMapSupport2.install)();
const DEFAULT_HOSTNAME = '127.0.0.1';
const DEFAULT_PORT = 4444;

/**
 * helper to detect the Selenium backend according to given capabilities
 */
function detectBackend(options = {}) {
    const port = options.port,
          hostname = options.hostname,
          user = options.user,
          key = options.key;

    /**
     * browserstack
     * e.g. zHcv9sZ39ip8ZPsxBVJ2
     */

    if (typeof user === 'string' && key.length === 20) {
        return {
            hostname: 'hub.browserstack.com',
            port: 80
        };
    }

    /**
     * testingbot
     * e.g. ec337d7b677720a4dde7bd72be0bfc67
     */
    if (typeof user === 'string' && key.length === 32) {
        return {
            hostname: 'hub.testingbot.com',
            port: 80
        };
    }

    /**
     * Sauce Labs
     * e.g. 50aa152c-1932-B2f0-9707-18z46q2n1mb0
     */
    if (typeof user === 'string' && key.length === 36) {
        return {
            protocol: 'https',
            hostname: 'ondemand.saucelabs.com',
            port: 443
        };
    }

    /**
     * no cloud provider detected, fallback to local browser driver
     */
    return {
        hostname: hostname || DEFAULT_HOSTNAME,
        port: port || DEFAULT_PORT
    };
}

/**
 * initialise WebdriverIO compliant plugins
 */
function initialisePlugin(name, type) {
    /**
     * don't populate scoped package names
     */
    const pkgName = name[0] === '@' ? name : `wdio-${name.toLowerCase()}-${type}`;

    try {
        return require(pkgName);
    } catch (e) {
        if (!e.message.match(`Cannot find module '${pkgName}'`)) {
            throw new Error(`Couldn't initialise "${name}" ${type}.\n${e.stack}`);
        }

        throw new Error(`Couldn't find plugin "${pkgName}". You need to install it ` + `with \`$ npm install ${pkgName}\`!\n${e.stack}`);
    }
}

function validateConfig(defaults, options) {
    const params = {};

    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
        for (var _iterator = Object.entries(defaults)[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            const _ref = _step.value;

            var _ref2 = _slicedToArray(_ref, 2);

            const name = _ref2[0];
            const expectedOption = _ref2[1];

            /**
             * check if options is given
             */
            if (typeof options[name] === 'undefined' && !expectedOption.default && expectedOption.required) {
                throw new Error(`Required option "${name}" is missing`);
            }

            if (typeof options[name] === 'undefined' && expectedOption.default) {
                params[name] = expectedOption.default;
            }

            if (typeof options[name] !== 'undefined') {
                if (typeof expectedOption.type === 'string' && typeof options[name] !== expectedOption.type) {
                    throw new Error(`Expected option "${name}" to be type of ${expectedOption.type} but was ${typeof options[name]}`);
                }

                if (typeof expectedOption.type === 'function') {
                    try {
                        expectedOption.type(options[name]);
                    } catch (e) {
                        throw new Error(`Type check for option "${name}" failed: ${e.message}`);
                    }
                }

                if (expectedOption.match && !options[name].match(expectedOption.match)) {
                    throw new Error(`Option "${name}" doesn't match expected values: ${expectedOption.match}`);
                }

                params[name] = options[name];
            }
        }
    } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
    } finally {
        try {
            if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
            }
        } finally {
            if (_didIteratorError) {
                throw _iteratorError;
            }
        }
    }

    return params;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlscy5qcyJdLCJuYW1lcyI6WyJkZXRlY3RCYWNrZW5kIiwiaW5pdGlhbGlzZVBsdWdpbiIsInZhbGlkYXRlQ29uZmlnIiwiREVGQVVMVF9IT1NUTkFNRSIsIkRFRkFVTFRfUE9SVCIsIm9wdGlvbnMiLCJwb3J0IiwiaG9zdG5hbWUiLCJ1c2VyIiwia2V5IiwibGVuZ3RoIiwicHJvdG9jb2wiLCJuYW1lIiwidHlwZSIsInBrZ05hbWUiLCJ0b0xvd2VyQ2FzZSIsInJlcXVpcmUiLCJlIiwibWVzc2FnZSIsIm1hdGNoIiwiRXJyb3IiLCJzdGFjayIsImRlZmF1bHRzIiwicGFyYW1zIiwiT2JqZWN0IiwiZW50cmllcyIsImV4cGVjdGVkT3B0aW9uIiwiZGVmYXVsdCIsInJlcXVpcmVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O1FBTWdCQSxhLEdBQUFBLGE7UUFpREFDLGdCLEdBQUFBLGdCO1FBb0JBQyxjLEdBQUFBLGM7O0FBM0VoQixNQUFNQyxtQkFBbUIsV0FBekI7QUFDQSxNQUFNQyxlQUFlLElBQXJCOztBQUVBOzs7QUFHTyxTQUFTSixhQUFULENBQXdCSyxVQUFVLEVBQWxDLEVBQXNDO0FBQUEsVUFDakNDLElBRGlDLEdBQ0hELE9BREcsQ0FDakNDLElBRGlDO0FBQUEsVUFDM0JDLFFBRDJCLEdBQ0hGLE9BREcsQ0FDM0JFLFFBRDJCO0FBQUEsVUFDakJDLElBRGlCLEdBQ0hILE9BREcsQ0FDakJHLElBRGlCO0FBQUEsVUFDWEMsR0FEVyxHQUNISixPQURHLENBQ1hJLEdBRFc7O0FBR3pDOzs7OztBQUlBLFFBQUksT0FBT0QsSUFBUCxLQUFnQixRQUFoQixJQUE0QkMsSUFBSUMsTUFBSixLQUFlLEVBQS9DLEVBQW1EO0FBQy9DLGVBQU87QUFDSEgsc0JBQVUsc0JBRFA7QUFFSEQsa0JBQU07QUFGSCxTQUFQO0FBSUg7O0FBRUQ7Ozs7QUFJQSxRQUFJLE9BQU9FLElBQVAsS0FBZ0IsUUFBaEIsSUFBNEJDLElBQUlDLE1BQUosS0FBZSxFQUEvQyxFQUFtRDtBQUMvQyxlQUFPO0FBQ0hILHNCQUFVLG9CQURQO0FBRUhELGtCQUFNO0FBRkgsU0FBUDtBQUlIOztBQUVEOzs7O0FBSUEsUUFBSSxPQUFPRSxJQUFQLEtBQWdCLFFBQWhCLElBQTRCQyxJQUFJQyxNQUFKLEtBQWUsRUFBL0MsRUFBbUQ7QUFDL0MsZUFBTztBQUNIQyxzQkFBVSxPQURQO0FBRUhKLHNCQUFVLHdCQUZQO0FBR0hELGtCQUFNO0FBSEgsU0FBUDtBQUtIOztBQUVEOzs7QUFHQSxXQUFPO0FBQ0hDLGtCQUFVQSxZQUFZSixnQkFEbkI7QUFFSEcsY0FBTUEsUUFBUUY7QUFGWCxLQUFQO0FBSUg7O0FBRUQ7OztBQUdPLFNBQVNILGdCQUFULENBQTJCVyxJQUEzQixFQUFpQ0MsSUFBakMsRUFBdUM7QUFDMUM7OztBQUdBLFVBQU1DLFVBQVVGLEtBQUssQ0FBTCxNQUFZLEdBQVosR0FBa0JBLElBQWxCLEdBQTBCLFFBQU9BLEtBQUtHLFdBQUwsRUFBbUIsSUFBR0YsSUFBSyxFQUE1RTs7QUFFQSxRQUFJO0FBQ0EsZUFBT0csUUFBUUYsT0FBUixDQUFQO0FBQ0gsS0FGRCxDQUVFLE9BQU9HLENBQVAsRUFBVTtBQUNSLFlBQUksQ0FBQ0EsRUFBRUMsT0FBRixDQUFVQyxLQUFWLENBQWlCLHVCQUFzQkwsT0FBUSxHQUEvQyxDQUFMLEVBQXlEO0FBQ3JELGtCQUFNLElBQUlNLEtBQUosQ0FBVyx3QkFBdUJSLElBQUssS0FBSUMsSUFBSyxNQUFLSSxFQUFFSSxLQUFNLEVBQTdELENBQU47QUFDSDs7QUFFRCxjQUFNLElBQUlELEtBQUosQ0FDRCx5QkFBd0JOLE9BQVEsNEJBQWpDLEdBQ0Msd0JBQXVCQSxPQUFRLFFBQU9HLEVBQUVJLEtBQU0sRUFGN0MsQ0FBTjtBQUlIO0FBQ0o7O0FBRU0sU0FBU25CLGNBQVQsQ0FBeUJvQixRQUF6QixFQUFtQ2pCLE9BQW5DLEVBQTRDO0FBQy9DLFVBQU1rQixTQUFTLEVBQWY7O0FBRCtDO0FBQUE7QUFBQTs7QUFBQTtBQUcvQyw2QkFBcUNDLE9BQU9DLE9BQVAsQ0FBZUgsUUFBZixDQUFyQyw4SEFBK0Q7QUFBQTs7QUFBQTs7QUFBQSxrQkFBbkRWLElBQW1EO0FBQUEsa0JBQTdDYyxjQUE2Qzs7QUFDM0Q7OztBQUdBLGdCQUFJLE9BQU9yQixRQUFRTyxJQUFSLENBQVAsS0FBeUIsV0FBekIsSUFBd0MsQ0FBQ2MsZUFBZUMsT0FBeEQsSUFBbUVELGVBQWVFLFFBQXRGLEVBQWdHO0FBQzVGLHNCQUFNLElBQUlSLEtBQUosQ0FBVyxvQkFBbUJSLElBQUssY0FBbkMsQ0FBTjtBQUNIOztBQUVELGdCQUFJLE9BQU9QLFFBQVFPLElBQVIsQ0FBUCxLQUF5QixXQUF6QixJQUF3Q2MsZUFBZUMsT0FBM0QsRUFBb0U7QUFDaEVKLHVCQUFPWCxJQUFQLElBQWVjLGVBQWVDLE9BQTlCO0FBQ0g7O0FBRUQsZ0JBQUksT0FBT3RCLFFBQVFPLElBQVIsQ0FBUCxLQUF5QixXQUE3QixFQUEwQztBQUN0QyxvQkFBSSxPQUFPYyxlQUFlYixJQUF0QixLQUErQixRQUEvQixJQUEyQyxPQUFPUixRQUFRTyxJQUFSLENBQVAsS0FBeUJjLGVBQWViLElBQXZGLEVBQTZGO0FBQ3pGLDBCQUFNLElBQUlPLEtBQUosQ0FBVyxvQkFBbUJSLElBQUssbUJBQWtCYyxlQUFlYixJQUFLLFlBQVcsT0FBT1IsUUFBUU8sSUFBUixDQUFjLEVBQXpHLENBQU47QUFDSDs7QUFFRCxvQkFBSSxPQUFPYyxlQUFlYixJQUF0QixLQUErQixVQUFuQyxFQUErQztBQUMzQyx3QkFBSTtBQUNBYSx1Q0FBZWIsSUFBZixDQUFvQlIsUUFBUU8sSUFBUixDQUFwQjtBQUNILHFCQUZELENBRUUsT0FBT0ssQ0FBUCxFQUFVO0FBQ1IsOEJBQU0sSUFBSUcsS0FBSixDQUFXLDBCQUF5QlIsSUFBSyxhQUFZSyxFQUFFQyxPQUFRLEVBQS9ELENBQU47QUFDSDtBQUNKOztBQUVELG9CQUFJUSxlQUFlUCxLQUFmLElBQXdCLENBQUNkLFFBQVFPLElBQVIsRUFBY08sS0FBZCxDQUFvQk8sZUFBZVAsS0FBbkMsQ0FBN0IsRUFBd0U7QUFDcEUsMEJBQU0sSUFBSUMsS0FBSixDQUFXLFdBQVVSLElBQUssb0NBQW1DYyxlQUFlUCxLQUFNLEVBQWxGLENBQU47QUFDSDs7QUFFREksdUJBQU9YLElBQVAsSUFBZVAsUUFBUU8sSUFBUixDQUFmO0FBQ0g7QUFDSjtBQWxDOEM7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFvQy9DLFdBQU9XLE1BQVA7QUFDSCIsImZpbGUiOiJ1dGlscy5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IERFRkFVTFRfSE9TVE5BTUUgPSAnMTI3LjAuMC4xJ1xuY29uc3QgREVGQVVMVF9QT1JUID0gNDQ0NFxuXG4vKipcbiAqIGhlbHBlciB0byBkZXRlY3QgdGhlIFNlbGVuaXVtIGJhY2tlbmQgYWNjb3JkaW5nIHRvIGdpdmVuIGNhcGFiaWxpdGllc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZGV0ZWN0QmFja2VuZCAob3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3QgeyBwb3J0LCBob3N0bmFtZSwgdXNlciwga2V5IH0gPSBvcHRpb25zXG5cbiAgICAvKipcbiAgICAgKiBicm93c2Vyc3RhY2tcbiAgICAgKiBlLmcuIHpIY3Y5c1ozOWlwOFpQc3hCVkoyXG4gICAgICovXG4gICAgaWYgKHR5cGVvZiB1c2VyID09PSAnc3RyaW5nJyAmJiBrZXkubGVuZ3RoID09PSAyMCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaG9zdG5hbWU6ICdodWIuYnJvd3NlcnN0YWNrLmNvbScsXG4gICAgICAgICAgICBwb3J0OiA4MFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogdGVzdGluZ2JvdFxuICAgICAqIGUuZy4gZWMzMzdkN2I2Nzc3MjBhNGRkZTdiZDcyYmUwYmZjNjdcbiAgICAgKi9cbiAgICBpZiAodHlwZW9mIHVzZXIgPT09ICdzdHJpbmcnICYmIGtleS5sZW5ndGggPT09IDMyKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBob3N0bmFtZTogJ2h1Yi50ZXN0aW5nYm90LmNvbScsXG4gICAgICAgICAgICBwb3J0OiA4MFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2F1Y2UgTGFic1xuICAgICAqIGUuZy4gNTBhYTE1MmMtMTkzMi1CMmYwLTk3MDctMTh6NDZxMm4xbWIwXG4gICAgICovXG4gICAgaWYgKHR5cGVvZiB1c2VyID09PSAnc3RyaW5nJyAmJiBrZXkubGVuZ3RoID09PSAzNikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcHJvdG9jb2w6ICdodHRwcycsXG4gICAgICAgICAgICBob3N0bmFtZTogJ29uZGVtYW5kLnNhdWNlbGFicy5jb20nLFxuICAgICAgICAgICAgcG9ydDogNDQzXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBubyBjbG91ZCBwcm92aWRlciBkZXRlY3RlZCwgZmFsbGJhY2sgdG8gbG9jYWwgYnJvd3NlciBkcml2ZXJcbiAgICAgKi9cbiAgICByZXR1cm4ge1xuICAgICAgICBob3N0bmFtZTogaG9zdG5hbWUgfHwgREVGQVVMVF9IT1NUTkFNRSxcbiAgICAgICAgcG9ydDogcG9ydCB8fCBERUZBVUxUX1BPUlRcbiAgICB9XG59XG5cbi8qKlxuICogaW5pdGlhbGlzZSBXZWJkcml2ZXJJTyBjb21wbGlhbnQgcGx1Z2luc1xuICovXG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGlzZVBsdWdpbiAobmFtZSwgdHlwZSkge1xuICAgIC8qKlxuICAgICAqIGRvbid0IHBvcHVsYXRlIHNjb3BlZCBwYWNrYWdlIG5hbWVzXG4gICAgICovXG4gICAgY29uc3QgcGtnTmFtZSA9IG5hbWVbMF0gPT09ICdAJyA/IG5hbWUgOiBgd2Rpby0ke25hbWUudG9Mb3dlckNhc2UoKX0tJHt0eXBlfWBcblxuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiByZXF1aXJlKHBrZ05hbWUpXG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBpZiAoIWUubWVzc2FnZS5tYXRjaChgQ2Fubm90IGZpbmQgbW9kdWxlICcke3BrZ05hbWV9J2ApKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkbid0IGluaXRpYWxpc2UgXCIke25hbWV9XCIgJHt0eXBlfS5cXG4ke2Uuc3RhY2t9YClcbiAgICAgICAgfVxuXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBDb3VsZG4ndCBmaW5kIHBsdWdpbiBcIiR7cGtnTmFtZX1cIi4gWW91IG5lZWQgdG8gaW5zdGFsbCBpdCBgICtcbiAgICAgICAgICAgIGB3aXRoIFxcYCQgbnBtIGluc3RhbGwgJHtwa2dOYW1lfVxcYCFcXG4ke2Uuc3RhY2t9YFxuICAgICAgICApXG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVDb25maWcgKGRlZmF1bHRzLCBvcHRpb25zKSB7XG4gICAgY29uc3QgcGFyYW1zID0ge31cblxuICAgIGZvciAoY29uc3QgW25hbWUsIGV4cGVjdGVkT3B0aW9uXSBvZiBPYmplY3QuZW50cmllcyhkZWZhdWx0cykpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGNoZWNrIGlmIG9wdGlvbnMgaXMgZ2l2ZW5cbiAgICAgICAgICovXG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9uc1tuYW1lXSA9PT0gJ3VuZGVmaW5lZCcgJiYgIWV4cGVjdGVkT3B0aW9uLmRlZmF1bHQgJiYgZXhwZWN0ZWRPcHRpb24ucmVxdWlyZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgUmVxdWlyZWQgb3B0aW9uIFwiJHtuYW1lfVwiIGlzIG1pc3NpbmdgKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zW25hbWVdID09PSAndW5kZWZpbmVkJyAmJiBleHBlY3RlZE9wdGlvbi5kZWZhdWx0KSB7XG4gICAgICAgICAgICBwYXJhbXNbbmFtZV0gPSBleHBlY3RlZE9wdGlvbi5kZWZhdWx0XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnNbbmFtZV0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGV4cGVjdGVkT3B0aW9uLnR5cGUgPT09ICdzdHJpbmcnICYmIHR5cGVvZiBvcHRpb25zW25hbWVdICE9PSBleHBlY3RlZE9wdGlvbi50eXBlKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCBvcHRpb24gXCIke25hbWV9XCIgdG8gYmUgdHlwZSBvZiAke2V4cGVjdGVkT3B0aW9uLnR5cGV9IGJ1dCB3YXMgJHt0eXBlb2Ygb3B0aW9uc1tuYW1lXX1gKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGV4cGVjdGVkT3B0aW9uLnR5cGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBleHBlY3RlZE9wdGlvbi50eXBlKG9wdGlvbnNbbmFtZV0pXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFR5cGUgY2hlY2sgZm9yIG9wdGlvbiBcIiR7bmFtZX1cIiBmYWlsZWQ6ICR7ZS5tZXNzYWdlfWApXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZXhwZWN0ZWRPcHRpb24ubWF0Y2ggJiYgIW9wdGlvbnNbbmFtZV0ubWF0Y2goZXhwZWN0ZWRPcHRpb24ubWF0Y2gpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBPcHRpb24gXCIke25hbWV9XCIgZG9lc24ndCBtYXRjaCBleHBlY3RlZCB2YWx1ZXM6ICR7ZXhwZWN0ZWRPcHRpb24ubWF0Y2h9YClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGFyYW1zW25hbWVdID0gb3B0aW9uc1tuYW1lXVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhcmFtc1xufVxuIl19